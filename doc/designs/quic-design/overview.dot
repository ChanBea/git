strict digraph overview {
    node [style=filled, fillcolor="#009e73", shape=rectangle, color=black];
    bgcolor="transparent";
    bgcolor=white;
    layout=dot;
    outputorder="edgesfirst"
    rankdir=TB

    subgraph cluster_ssl {
        node [style=filled, fillcolor="#cc79a7"];
        label="SSL";
        style=filled;
        fillcolor="grey95:grey60";
        shape=rectangle
        rank=source

        ssl [label="SSL API", shape=rectangle, fillcolor="#cc79a7"];
    }
    subgraph cluster_bios {
        node [style=filled, fillcolor="#cc79a7"];
        label="BIOs";
        style=filled;
        fillcolor="/blues8/1:/blues8/4";
        shape=rectangle

        node [label="Datagram BIO", fillcolor="#f0e442"];
        color=transparent;

        dgbio1;
        dgbio2;
        dgbio3;
    }
    subgraph cluster_write {
        node [style=filled, fillcolor="#cc79a7"];
        label="Writing";
        style=filled;
        fillcolor="/blues8/1:/blues8/4";
        shape=rectangle

        ssb [label="Stream\nSend Buffers", fillcolor="#d55e00"];
        txp [label="TX Packetiser", fillcolor="#d55e00"];
        wrl [label="QUIC Write\nRecord Layer", fillcolor="#d55e00"];
    }
    subgraph cluster_read {
        node [style=filled, fillcolor="#cc79a7"];
        label="Reading";
        style=filled;
        fillcolor="/blues8/1:/blues8/4";
        shape=rectangle

        srb [label="Stream\nRead Buffers", fillcolor="#d55e00"];
        rxfh [label="RX Frame\nHandler", fillcolor="#d55e00"];
        rrl [label="QUIC Read\nRecord Layer", fillcolor="#d55e00"];
        demux [label="Path and Connection\nDemultiplexer", fillcolor="#d55e00"];
    }
    cc [label="Congestion\nController", fillcolor="#f0e442"];
    csm [label="Connection\nState Machine", fillcolor="#d55e00"];
    event [label="Timer and\nEvent Queue"];
    flow [label="Flow Controller and\nStatistics Collector", fillcolor="#d55e00"];
    tlshs [label="TLS Handshake\nRecord Layer", fillcolor="#d55e00"];
    ackm [label="ACK Handling and\nLoss Detector", fillcolor="#f0e442"];
    idc [label="Connection\nID Cache", fillcolor="#d55e00"];

    subgraph cluster_kernel {
        node [style=filled, fillcolor="#cc79a7", label="UDP"];
        label="       Kernel";
        style=filled;
        fillcolor="grey95:grey60";
        shape=rectangle
        rank=sink

        udp1;
        udp2;
        udp3;
        hw [label="Hardware Interfaces"];

        udp1 -> hw;
        udp2 -> hw;
        udp3 -> hw;
    }

    ssl -> ssb -> txp -> wrl;
    demux -> rrl -> rxfh -> srb -> ssl;
    ssl -> csm [dir=both];
    ssl -> tlshs [dir=both];
    txp -> cc [dir=both];
    txp -> flow [dir=both];
    txp -> ackm;
    flow -> rxfh [dir=both];
    ackm -> event [dir=both];
    ackm -> cc;
    csm -> event [dir=both];
    tlshs -> csm [dir=both];
    tlshs -> txp;
    csm -> idc;
    idc -> demux;
    rxfh -> ackm;
    rxfh -> tlshs;

    dgbio1 -> udp1 [dir=both];
    dgbio2 -> udp2 [dir=both];
    dgbio3 -> udp3 [dir=both];
    udp1 -> hw [dir=both];
    udp2 -> hw [dir=both];
    udp3 -> hw [dir=both];

    edge[samehead=h1, sametail=t1];
    wrl -> dgbio1 -> demux [samehead="bioh"];
    wrl -> dgbio2 -> demux [samehead="bioh"];
    wrl -> dgbio3 -> demux [samehead="bioh"];

    subgraph cluster_key {
        shape=rectangle
        node [style=filled];
        label="Key";
        style=filled;
        fillcolor="grey80";
        rankdir=LR

        External [fillcolor="#cc79a7"];
        Done [fillcolor="#009e73"];
        Implementing [fillcolor="#f0e442"];
        Designing [fillcolor="#d55e00"];
    }
}
