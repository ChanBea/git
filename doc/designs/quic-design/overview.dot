strict digraph overview {
    node [style=filled, fillcolor="#009e73", shape=rectangle, color=black];
    bgcolor="transparent";
    bgcolor=white;
    layout=dot;
    outputorder="edgesfirst"
    rankdir=TB;
    //ranksep=.75;

{
    node [style=invis];
    10 -> 20 -> 30 -> 40 -> 50 -> 60 -> 70 -> 80 -> 90 -> 100 [ style = invis ];
}
    subgraph cluster_key {
        shape=rectangle
        node [style=filled];
        label="Key";
        style=filled;
        fillcolor="grey80";
        rankdir=LR
        labeljust=l

        External [fillcolor="#cc79a7"];
        Done [fillcolor="#009e73"];
        Implementing [fillcolor="#f0e442"];
        Designing [fillcolor="#d55e00"];
    }

    subgraph cluster_ssl {
        node [style=filled, fillcolor="#cc79a7"];
        label="SSL";
        style=filled;
        fillcolor="grey95:grey60";
        shape=rectangle
        rank=same; 10;
        labeljust=l

        ssl [label="SSL API", shape=rectangle, fillcolor="#cc79a7"];
    }
    subgraph cluster_bios {
        node [style=filled, fillcolor="#cc79a7"];
        label="BIOs";
        style=filled;
        fillcolor="/blues8/1:/blues8/4";
        shape=rectangle
        rank=same; 80;
        labeljust=l

        node [label="Datagram BIO", fillcolor="#f0e442"];
        color=transparent;

        dgbio1;
        dgbio2;
        dgbio3;
    }
    
    subgraph cluster_write {
        node [style=filled];
        label="Writing";
        style=filled;
        fillcolor="/blues8/1:/blues8/4";
        shape=rectangle
        labeljust=l

        node [ fillcolor="#d55e00", label="Stream\nSend Buffers"; ];
            { rank=same; 30; ssb }
        node [ fillcolor="#d55e00", label="TX Packetiser"; ];
            { rank=same; 40; txp }
        node [ fillcolor="#d55e00", label="QUIC Write\nRecord Layer"; ];
            { rank=same; 50; wrl }
    }
    
    subgraph cluster_read {
        node [style=filled];
        label="Reading";
        style=filled;
        fillcolor="/blues8/1:/blues8/4";
        shape=rectangle
        labeljust=l

        node [ fillcolor="#d55e00", label="Stream\nRead Buffers"; ];
            { rank=same; 30; srb }
        node [ fillcolor="#d55e00", label="RX Frame\nHandler"; ];
            { rank=same; 40; rxfh }
        node [ fillcolor="#d55e00", label="QUIC Read\nRecord Layer"; ];
            { rank=same; 50; rrl }
        node [ fillcolor="#d55e00", label="Path and Connection\nDemultiplexer" ];
            { rank=same; 60; demux }
    }

    node [label="Congestion\nController", fillcolor="#f0e442"];
        { rank=same; 50; cc }
    node [label="Connection\nState Machine", fillcolor="#d55e00"];
        { rank=same; 20; csm }
    node [label="Timer and\nEvent Queue"];
        { rank=same; 30; event }
    node [label="Flow Controller and\nStatistics Collector", fillcolor="#d55e00"];
        { rank=same; 40; flow }
    node [label="TLS Handshake\nRecord Layer", fillcolor="#d55e00"];
        { rank=same; 20; tlshs }
    node [label="ACK Handling and\nLoss Detector", fillcolor="#f0e442"];
        { rank=same; 40; ackm }
    node [label="Connection\nID Cache", fillcolor="#d55e00"];
        { rank=same; 20; idc }

    subgraph cluster_kernel {
        label="Kernel";
        style=filled;
        fillcolor="grey95:grey60";
        shape=rectangle
        rank=sink
        labeljust=l

        node [style=filled, fillcolor="#cc79a7", label="UDP"];
        { rank=same; 90; udp1; udp2; udp3; }
        node [style=filled, fillcolor="#cc79a7", label="Hardware Interfaces"];
        { rank=same; 100; hw }

        udp1 -> hw;
        udp2 -> hw;
        udp3 -> hw;
    }

    ssl -> ssb -> txp -> wrl;
    demux -> rrl -> rxfh -> srb -> ssl;
    ssl -> csm [dir=both];
    ssl -> tlshs [dir=both];
    txp -> cc [dir=both];
    txp -> flow [dir=both];
    txp -> ackm;
    flow -> rxfh [dir=both];
    ackm -> event [dir=both];
    ackm -> cc;
    csm -> event [dir=both];
    tlshs -> csm [dir=both];
    tlshs -> txp;
    csm -> idc;
    idc -> demux;
    rxfh -> ackm;
    rxfh -> tlshs;

    dgbio1 -> udp1 [dir=both];
    dgbio2 -> udp2 [dir=both];
    dgbio3 -> udp3 [dir=both];
    udp1 -> hw [dir=both];
    udp2 -> hw [dir=both];
    udp3 -> hw [dir=both];

    edge[samehead=h1, sametail=t1];
    wrl -> dgbio1 -> demux [samehead="bioh"];
    wrl -> dgbio2 -> demux [samehead="bioh"];
    wrl -> dgbio3 -> demux [samehead="bioh"];

}
