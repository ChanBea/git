strict digraph overview {
    node [style=filled, fillcolor="#009e73", shape=rectangle, color=black];
    //bgcolor="transparent";    will switch to this before merging
    bgcolor=white;
    layout=dot;

    ssl [label="SSL API", shape=rectangle, pos="0,0!", fillcolor="#cc79a7"];
    subgraph cluster1 {
        node [style=filled, fillcolor="#cc79a7", label="UDP"];
        label="       Kernel";
        style=filled;
        fillcolor="grey95:grey60";
        shape=rectangle

        udp1;
        udp2;
        udp3;
        hw [label="Hardware Interfaces"];

        udp1 -> hw;
        udp2 -> hw;
        udp3 -> hw;
    }
    subgraph cluster2 {
        node [label="Datagram BIO", fillcolor="#f0e442"];
        color=transparent;

        dgbio1;
        dgbio2;
        dgbio3;
    }
    subgraph cluster3 {
        color=transparent;

        ssb [label="Stream\nSend Buffers", fillcolor="#d55e00"];
        txp [label="TX Packetiser", fillcolor="#d55e00"];
        wrl [label="QUIC Write\nRecord Layer", fillcolor="#d55e00"];
    }
    cc [label="Congestion\nController", fillcolor="#f0e442"];
    csm [label="Connection\nState Machine", fillcolor="#d55e00"];
    event [label="Timer and\nEvent Queue"];
    flow [label="Flow Controller and\nStatistics Collector", fillcolor="#d55e00"];
    tlshs [label="TLS Handshake\nRecord Layer", fillcolor="#d55e00"];
    ackm [label="ACK Handling and\nLoss Detector", fillcolor="#f0e442"];
    idc [label="Connection\nID Cache", fillcolor="#d55e00"];
    subgraph cluster4 {
        color=transparent;

        srb [label="Stream\nRead Buffers", fillcolor="#d55e00"];
        rxfh [label="RX Frame\nHandler", fillcolor="#d55e00"];
        rrl [label="QUIC Read\nRecord Layer", fillcolor="#d55e00"];
        demux [label="Path and Connection\nDemultiplexer", fillcolor="#d55e00"];
    }

    ssl -> ssb;
    ssl -> csm [dir=both];
    ssl -> tlshs [dir=both];
    ssb -> txp;
    txp -> wrl;
    txp -> cc [dir=both];
    txp -> flow [dir=both];
    txp -> ackm;
    flow -> rxfh [dir=both];
    ackm -> event [dir=both];
    ackm -> cc;
    csm -> event [dir=both];
    tlshs -> csm [dir=both];
    tlshs -> txp;
    csm -> idc;
    idc -> demux;
    demux -> rrl;
    rrl -> rxfh;
    rxfh -> ackm;
    rxfh -> srb;
    rxfh -> tlshs;
    srb -> ssl;

    wrl -> dgbio1;
    wrl -> dgbio2;
    wrl -> dgbio3;
    dgbio1 -> udp1 [dir=both];
    dgbio2 -> udp2 [dir=both];
    dgbio3 -> udp3 [dir=both];
    dgbio1 -> demux;
    dgbio2 -> demux;
    dgbio3 -> demux;
    udp1 -> hw [dir=both];
    udp2 -> hw [dir=both];
    udp3 -> hw [dir=both];

    subgraph cluster_key {
        shape=rectangle
        node [style=filled];
        label="Key";
        style=filled;
        fillcolor="grey80";

        External [fillcolor="#cc79a7"];
        Done [fillcolor="#009e73"];
        Implementing [fillcolor="#f0e442"];
        Designing [fillcolor="#d55e00"];
    }
}
